<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Sesi√≥n 32 - Introducci√≥n a dplyr</title>
    <meta charset="utf-8" />
    <script src="index_files/header-attrs-2.5/header-attrs.js"></script>
    <link href="index_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="index_files/remark-css-0.0.1/shinobi.css" rel="stylesheet" />
    <link href="index_files/remark-css-0.0.1/tamu-fonts.css" rel="stylesheet" />
    <meta name="github-repo" content="r4hr/club_de_r"/>
    <meta name="twitter:title" content="Sesi√≥n abierta Dic. 2020 - Introducci√≥n a dplyr"/>
    <meta name="twitter:description" content="Una introducci√≥n a c√≥mo manipular y transformar datos con dplyr por el Club de R para RRHH"/>
    <meta name="twitter:url" content="https://clubder-rmarkdown.netlify.app/"/>
    <meta name="twitter:image:src" content="https://github.com/r4hr/r4hr_introduccion_dplyr/blob/main/Archivos/kiwi-fondo.png"/>
    <meta name="twitter:image:alt" content="Inttroducci√≥n a dplyr Desarrollada por el Club de R para RRHH"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:creator" content="@sergiogarciamor"/>
    <meta name="twitter:site" content="@club_rrhh"/>
    <meta property="og:title" content="Sesi√≥n abierta Dic. 2020 - Introducci√≥n a dplyr"/>
    <meta property="og:description" content="Una introducci√≥n a c√≥mo manipular y transformar datos con dplyr por el Club de R para RRHH"/>
    <meta property="og:url" content="https://clubder-rmarkdown.netlify.app/"/>
    <meta property="og:image" content="https://github.com/r4hr/r4hr_introduccion_dplyr/blob/main/Archivos/kiwi-fondo.png"/>
    <meta property="og:image:alt" content="Inttroducci√≥n a dplyr Desarrollada por el Club de R para RRHH"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="Sergio Garcia Mora"/>
    <script src="index_files/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="index_files/shareon-1.4.1/shareon.min.css" rel="stylesheet" />
    <script src="index_files/shareon-1.4.1/shareon.min.js"></script>
    <link href="index_files/xaringanExtra-shareagain-0.2.4/shareagain.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-shareagain-0.2.4/shareagain.js"></script>
  </head>
  <body>
    <textarea id="source">

class: inverse, top, center
background-image: url(Archivos/kiwi-fondo.png)
background-size: cover



---







???

Image credit: [Designed by Freepik]("http://www.freepik.com")

---
# Qui√©nes somos

El [Club de R para RRHH](https://r4hr.club) es una comunidad de aprendizaje de programaci√≥n en R destinada para las personas que trabajan en Recursos Humanos de habla hispana.

Nuestro objetivo es acercar el mundo de ciencias de datos a nuestra profesi√≥n, adaptando el contenido a nuestros skills y conocimientos, y tambi√©n siempre que podemos, usando datos relacionados con la gesti√≥n de personas y en castellano, para hacer m√°s accesible e inclusivo el aprendizaje.

Este es un proyecto que re√∫ne a gente de Argentina, Per√∫, Chile, Paraguay, Uruguay, Panam√°, USA, Francia, y cada vez m√°s y m√°s profesionales de distintas latitudes se unen y contribuyen al proyecto.

Para m√°s informaci√≥n sobre el Club de R le√© [este post](https://r4hr.club/2020/09/23/el-club-de-r-para-rrhh/), o escribinos a [info@r4hr.club](mailto:info@r4hr.club).

---
# Qui√©nes somos
## La encuesta KIWI ü•ù de Sueldos de RRHH para LATAM

Uno de los problemas en el aprendizaje de People Analytics es la falta de datasets para practicar, as√≠ que una decisi√≥n que tomamos fue el de generar nuestro propio dataset y de abrirlo para toda la comunidad.

Para hacer esta encuesta nos "inspiramos" en [SysArmy](https://sysarmy.com/blog/), una comunidad para las personas que trabajan en tecnolog√≠a que adem√°s de organizar uno de los eventos m√°s importantes de tecnolog√≠a de Argentina, **Nerdearla**, y que tambi√©n organizan una encuesta salarial dos veces por a√±o.

Estas son las motivaciones detr√°s de esta encuesta. Tener nuestro propio dataset, compartir los resultados y los datos, para que todos los entusiastas de RRHH y de los datos cuenten con una fuente de datos para practicar.

&gt; Si quer√©s conocer la historia detr√°s del nombre de la encuesta, la pod√©s [conocer aqu√≠](https://r4hr.club/why-kiwi/).

---
background-color: "#5D6D7E" 
# Qui√©nes somos
## Organizadores
.pull-left[
üïµ [Adri√°n Quiroga](https://www.linkedin.com/in/adrian-quiroga-ab57424b/) 

üë©‚Äçüíª [Alithu Castro](https://www.linkedin.com/in/alithucastro/)

üë©‚Äçüéì [Andrea Herpsomer](https://www.linkedin.com/in/andreaherpsomer/)

üë©‚Äçüé® [Carla Cirone](https://www.linkedin.com/in/carla-cirone-0566b095/)

üë©‚Äçüíª [Daniela Garc√≠a](https://www.linkedin.com/in/claudia-daniela-garcia-138b1a14b/)

üë©‚ÄçüöÄ [Luc√≠a Huil√©n G√≥mez](https://www.linkedin.com/in/luc%C3%ADa-huil%C3%A9n-g%C3%B3mez-93565276/)

üë®‚Äçüé§ [Santiago Lardone Quinodoz](https://www.linkedin.com/in/santiago-lardone-quinodoz-978588167/)

üêç [Sebasti√°n Lombra√±a](https://www.linkedin.com/in/santiago-lardone-quinodoz-978588167/)

ü§ò [Sergio Garc√≠a Mora](https://www.linkedin.com/in/sergiogarciamora/)

üë©‚Äçüè´ [Yanel Paulette](https://www.linkedin.com/in/yanelpaulette/)
]

.pull-right[&lt;img src="Archivos/impresentables.jpg"  /&gt;]
---
# Invitados

Habitualmente las presentaciones del Club las hacemos nosotros. Pero una vez al mes, invitamos a un Data Scientist que nos hable sobre un tema de su especialidad. As√≠ hemos tenido a gente como: 


--

.pull-left[

&lt;img src="Archivos/pablo_tiscornia.jpg" height="30" width="30" /&gt; [Pablo Tiscornia](https://www.linkedin.com/in/ptiscornia/): Paquete EPH.

&lt;img src="Archivos/pablo_casas.jpg" height="30" width="30" /&gt; [Pablo Casas](https://www.linkedin.com/in/pcasas/): An√°lisis Exploratorio con `funModeling`.

&lt;img src="Archivos/ana_diedrichs.jpg" height="30" width="30" /&gt; [Ana Laura Diedrichs](https://www.linkedin.com/in/ana-laura-diedrichs-47038415/): Introducci√≥n a control de versiones con Git.

&lt;img src="Archivos/hernan_escudero.jpg" height="30" width="30" /&gt; [Hern√°n Escudero](https://www.linkedin.com/in/hernanescudero/): Aplicaciones interactivas con `Shiny`.

&lt;img src="Archivos/angie_scetta.jpg" height="30" width="30" /&gt; [√Ångeles Scetta](https://www.linkedin.com/in/mar%C3%ADa-de-los-%C3%A1ngeles-scetta-b7b82a80/): An√°lisis de datos geoespaciales en R.  

&lt;img src="Archivos/paocorrales.png" height="30" width="30" /&gt; [Paola Corrales](https://paocorrales.github.io/): Publicar RMarkdown en la Web.  
]   

--

.pull-right[

### Y nuestros cr√©ditos "locales" üëè

&lt;img src="Archivos/alithu_castro.jpg" height="40" width="40" /&gt; [Alithu Castro](https://www.linkedin.com/in/alithucastro/): Estad√≠stica y notebooks de R.

&lt;img src="Archivos/luis_grau.jpg" height="40" width="40" /&gt; [Luis Grau](https://www.linkedin.com/in/luis-grau-r-212b3a9/): Formato de tablas con `kable`.

]

---
# Invitados
## Suscripci√≥n al Club de R para RRHH

Todos los s√°bados de 10:00 a 11:30 hs. nos reunimos para revisar paquetes, tipos de an√°lisis, proyectos, etc.. Mayormente utilizamos datos de RRHH (salvo los invitados) y en castellano para que s√≥lo nos preocupemos por entender R, y no tener que intentar comprender datos extra√±os.

--

La suscripci√≥n al Club tiene costo, que dedicamos principalmente a pagarlo los honorarios a los invitados, y a las licencias de algunas plataformas, pero desde **noviembre, la sesi√≥n del primer s√°bado de cada mes ser√° abierta y gratuita** üéâ.

.right[&lt;img src="Archivos/invitados.jpg" width="35%" /&gt;]

---

## Antes de empezar

Algunas cosas que tienen que saber:


--

* No hace falta que tengan la c√°mara encendida. üïµ

--

* Esta sesi√≥n queda grabada y la subimos a Youtube. üé•

--

* S√∫mense al grupo de [Slack](https://join.slack.com/t/r4hr/shared_invite/zt-geqfwra8-iZv3G5admNbyuej2gyFQDg) ya que todas las consultas las hacemos por ah√≠. ü§úü§õ

--

* Pueden interrumpir las veces que quieran. üôã

---
class: inverse center middle
# Empecemos!

&lt;img src="https://media.giphy.com/media/xT1TTBAzDPt5O8vKtW/giphy.gif" width="60%" /&gt;

---
# El lenguaje R
## Proyectos

Trabajar con proyectos en RStudio hace que todo el trabajo sea m√°s sencillo. Los proyectos crean una carpeta en nuestra PC en donde se almacenar√°n los archivos, tablas, scripts, y hace que todo sea m√°s organizado.

--

Para crear un proyecto ten√©s pod√©s entrar en:
* *File*
  * *New project*

Y luego poner el nombre de la carpeta.

.pull-left[&lt;img src="Archivos/new_project.png" width="60%" /&gt;]


.pull-rigt[&lt;img src="Archivos/new_projecto.png" width="30%" /&gt;]

---
# ¬øQu√© son los paquetes en R?

R es un lenguaje abierto de programaci√≥n, que se hizo muy popular para analizar datos pero que tienen infinidad de aplicaciones y usos que van m√°s all√° del an√°lisis estad√≠stico.

Los *paquetes* son una suerte de "extensiones" que ampl√≠an la capacidad de R base. Pablo Tiscornia hizo una analog√≠a muy buena para explicar qu√© son:

--

.pull-left[
&lt;img src="Archivos/R2.png" width="85%" /&gt;
]

--
.pull-right[
&lt;img src="Archivos/R4.png" /&gt;
]

---
# Instalando y cargando dplyr

Al igual que la gran mayor√≠a de los paquetes de R, podemos instalar el paquete directamente desde el script:


```r
# Instalando el paquete individual
install.packages("dplyr")

# Instalando el conjunto de paquetes de tidyverse
install.packages("tidyverse")
```

--

Antes de empezar a usar las funciones de dplyr, tenemos que cargarlo con la funci√≥n `library()`:

```r
library(dplyr)
```


---
# Tidy Data

Cuando hacemos alg√∫n tutorial, los datos est√°n perfectos, limpios, y prolijos. Y cuando quer√©s aplicar el mismo c√≥digo a tus propios datos, resulta que no funciona, o ten√©s que hacer mucho procesamiento de datos para terminar replicando un ejemplo de un tutorial.

--

Por estas razones, la limpieza de datos, suele representar entre el 60 al 80% de cualquier proyecto de Analytics, hasta lograr tener **datos ordenados** (tidy data). Entre algunos principios de *tidy data* podemos mencionar dos:

--

1. Cada variable forma una columna.
2. Cada observaci√≥n forma una fila.
3. Cada tipo de unidad observacional forma una tabla.

---
# dplyr


El paquete **dplyr** es uno de los paquetes embebidos dentro del paquete tidyverse: un conjunto de paquetes destinados a la limpieza y manipulaci√≥n de datos y que se convirti√≥ en un est√°ndar en la pr√°ctica de la limpieza y manipulaci√≥n de datos en R. `dplyr` fue desarrollado por Hadley Wickham, Romain Fran√ßois, Lionel Henry y Kirill M√ºller.

Una de las razones por las que se hizo tan popular es por su sintaxis simple, con nombres de funciones que usan palabras muy coloquiales, imitando la forma en la que hablamos.

Usualmente se dice que usamos `dplyr` para hacer *data wrangling*. As√≠ que empecemos a aprender a domar nuestros datos.

&lt;br&gt;&lt;br&gt;


.center[
&lt;img src="https://d33wubrfki0l68.cloudfront.net/621a9c8c5d7b47c4b6d72e8f01f28d14310e8370/193fc/css/images/hex/dplyr.png" width="15%" /&gt;
]

---
# A domar datos!

&lt;img src="https://media.giphy.com/media/d1Hrg00RXt3dfaFO/giphy.gif" /&gt;

---
class: inverse
# Los cheatsheets
## (machete, cola, trencito, copiat√≠n, plage, bater√≠a, torpedo, chuleta, chanchullo, etc.)

Los [*cheatsheet*](https://rstudio.com/resources/cheatsheets/) son documentos con res√∫menes de las principales funciones de los paquetes m√°s utilizados.

La comunidad de R de hispanoam√©rica ha traducido unos cuantos, gracias a quienes podemos contar hoy con un cheatsheet en [castellano](https://github.com/rstudio/cheatsheets/raw/master/translations/spanish/data-wrangling-cheatsheet_Spanish.pdf).

.right[
&lt;img src="https://espaciociencia.com//wp-content/uploads/como-copiar-en-examen.jpg" width="35%"/&gt;
]

---
# Los datasets

.pull-left[
&lt;img src="https://i.pinimg.com/originals/83/5c/33/835c33d22fd2ae61cbf0c14545524d54.jpg" /&gt;

]

.pull-right[

```r
library(dplyr) # Manipulaci√≥n y limpieza de datos
library(readr) # Lectura y carga de archivos

# Cargamos encuesta de sueldos
encuesta &lt;- read_delim("https://raw.githubusercontent.com/r4hr/r4hr_introduccion_dplyr/main/Datos/encuesta_sueldos.csv", delim = ",")

# Cargamos otro archivo con kpis de ausentismo y de horas extras
kpis &lt;- read_delim("https://raw.githubusercontent.com/r4hr/r4hr_introduccion_dplyr/main/Datos/kpi_aus_he.csv", delim = ";")
```
]
---
# Los "verbos" en dplyr

Una de las razones por las cuales tidyverse se hizo tan popular es que la l√≥gica de las funciones imita el razonamiento que har√≠amos verbalmente.

--

Por ejemplo, ¬øc√≥mo har√≠an para calcular el sueldo promedio por puesto?

--


```r
encuesta %&gt;% 
  select(puesto, sueldo_bruto) %&gt;% # Selecciona las columnas
  group_by(puesto) %&gt;%     # Agrupa por la variable puesto
  summarise(sueldo_promedio = mean(sueldo_bruto)) %&gt;% # Crea una variable con el sueldo promedio
  arrange(-sueldo_promedio) # Ordena descendentemente los resultados por la variable que pasemos.
```

```
## # A tibble: 7 x 2
##   puesto         sueldo_promedio
##   &lt;chr&gt;                    &lt;dbl&gt;
## 1 Gerente                230972.
## 2 Director               210788.
## 3 Jefe                   110486.
## 4 HRBP                    93805.
## 5 Responsable             75024.
## 6 Analista                68061.
## 7 Administrativo          44154.
```

---
# dplyr
## El "pipe"

¬øVieron este s√≠mbolo `%&gt;%` en la slide anterior? En la jerga lo conocemos como *"pipe"* (atajo de teclado Ctrl + May√∫s + M). Lo que nos permite este *"tubo"* es ordenar el c√≥digo en secuencias, haci√©ndolo m√°s comprensible a la lectura.

Una de las ventajas del *pipe* es que no necesitamos invocar al dataframe en cada funci√≥n que encadenamos en el pipe.

.center[
&lt;img src="Archivos/dplyr_funciones.png" width="57%"/&gt;
]

---
# dplyr
## Secuencias

Por ejemplo, si quiero ver los sueldos brutos por puesto de las personas que no tienen gente a cargo ordenados por el puesto. Los pasos son:

1. Elegir las variables puesto, sueldo_bruto, personas_a_cargo.
2. Filtrar de la variable personas_a_cargo los casos que no tienen gente a cargo.
3. Ordenar los resultados por puesto.

&gt; Ac√° estoy usando la funci√≥n `head()` para que quede prolijo en la presentaci√≥n. Ustedes no la usen y recuerden sacar el √∫ltimo par√©ntesis


```r
head(arrange(filter(select(encuesta, puesto, sueldo_bruto, personas_a_cargo), personas_a_cargo &gt; 0), puesto))
```

```
## # A tibble: 6 x 3
##   puesto         sueldo_bruto personas_a_cargo
##   &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
## 1 Administrativo        94050                4
## 2 Analista             650000               70
## 3 Analista              37000               44
## 4 Analista              65500                2
## 5 Analista              45500              120
## 6 Analista             134000                2
```

---

## dplyr

Esto mismo usando el pipe de dplyr lo hacemos as√≠:

```r
encuesta %&gt;%
  select(puesto, sueldo_bruto, personas_a_cargo) %&gt;%
  filter(personas_a_cargo&gt;0) %&gt;%
  arrange(puesto) %&gt;% 
  head()
```

```
## # A tibble: 6 x 3
##   puesto         sueldo_bruto personas_a_cargo
##   &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
## 1 Administrativo        94050                4
## 2 Analista             650000               70
## 3 Analista              37000               44
## 4 Analista              65500                2
## 5 Analista              45500              120
## 6 Analista             134000                2
```


---
# ¬øCu√°l es m√°s f√°cil de entender?
&lt;br&gt;

### C√≥digo sin el pipe


```r
arrange(filter(select(encuesta, puesto, sueldo_bruto, personas_a_cargo), personas_a_cargo &gt; 0), puesto)
```


### C√≥digo con el pipe


```r
encuesta %&gt;%
  select(puesto, sueldo_bruto, personas_a_cargo) %&gt;%
  filter(personas_a_cargo&gt;0) %&gt;%
  arrange(puesto)
```
---

class: inverse, middle
background-image: url("Archivos/dplyr.png")
background-size: cover

---
# Las funciones de dplyr
## select()

La funci√≥n `select()` sirve para elegir las columnas (variables) con las que queremos trabajar. Tambi√©n nos permite traer las columnas en el orden que las necesitemos.


```r
encuesta %&gt;% 
  select(satisfaccion, sueldo_bruto) %&gt;% 
  head()
```

```
## # A tibble: 6 x 2
##   satisfaccion sueldo_bruto
##          &lt;dbl&gt;        &lt;dbl&gt;
## 1            2       41000 
## 2            4       40000 
## 3            3       43954.
## 4            3       40000 
## 5            2       15000 
## 6            3       57000
```

---
## select()

select() tiene algunas variantes interesantes (y en general aplican para casi todas las funciones de dplyr).

Supongamos que quiera seleccionar todas las columnas num√©ricas nada m√°s:



```r
encuesta %&gt;%
  select_if(is.numeric) %&gt;% 
  head()
```

```
## # A tibble: 6 x 8
##    edad empleados empleados_rh personas_a_cargo anios_rh sueldo_bruto aumento
##   &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;
## 1    31       400            6                0        8       41000        0
## 2    28       150            3                0        9       40000       10
## 3    25       186            2                0        2       43954.       0
## 4    33         4            1                0        3       40000       20
## 5    24        80            1                0        1       15000        0
## 6    30       135            3                0        6       57000        0
## # ... with 1 more variable: satisfaccion &lt;dbl&gt;
```

---


## filter()

.pull-left[
`filter()` nos permite obtener las filas (observaciones) que cumplen con las condiciones que necesitamos.

Empleados que tienen hijos


```r
encuesta %&gt;%
  select(personas_a_cargo, sueldo_bruto) %&gt;% 
  filter(personas_a_cargo  &gt; 0) %&gt;% 
  head()
```

```
## # A tibble: 6 x 2
##   personas_a_cargo sueldo_bruto
##              &lt;dbl&gt;        &lt;dbl&gt;
## 1                4        94050
## 2               70       650000
## 3               44        37000
## 4                2        65500
## 5              120        45500
## 6                2       134000
```

]

.pull-right[
Estas son los operadores l√≥gicos que nos van a ayudar con la funci√≥n filter.

&lt;img src="Archivos/operadores.png" /&gt;
]

---

## filter()

filter() nos permite obtener las filas (observaciones) que cumplen con las condiciones que necesitamos.

Listado de respuestas de Universidad Privada y de empresas con m√°s de 700 empleados.


```r
# Filtramos los empleados que son de Universidad Privada y de empresas con m√°s de 700 empleados.
encuesta %&gt;%
  filter(universidad == "Universidad Privada" &amp;  empleados &gt; 700)
```

```
## # A tibble: 61 x 15
##    genero  edad universidad rubro empleados origen_capital empleados_rh puesto
##    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt; 
##  1 Femen~    23 Universida~ Alim~     10000 Nacional                 40 Admin~
##  2 Femen~    32 Universida~ Serv~     10000 Multinacional            10 Admin~
##  3 Femen~    35 Universida~ Come~      1433 Nacional                 10 Anali~
##  4 Femen~    41 Universida~ Tran~      1000 Nacional                  8 Anali~
##  5 Femen~    27 Universida~ Prod~      5350 Multinacional           160 Anali~
##  6 Femen~    31 Universida~ Petr~     60000 Multinacional          2500 Anali~
##  7 Mascu~    29 Universida~ Banc~      5000 Nacional                  0 Anali~
##  8 Femen~    34 Universida~ Tecn~      3500 Multinacional            50 Anali~
##  9 Femen~    23 Universida~ Educ~      1300 Nacional                 12 Anali~
## 10 Mascu~    24 Universida~ Hote~      3500 Multinacional           100 Anali~
## # ... with 51 more rows, and 7 more variables: personas_a_cargo &lt;dbl&gt;,
## #   anios_rh &lt;dbl&gt;, sueldo_bruto &lt;dbl&gt;, aumento &lt;dbl&gt;, erp &lt;chr&gt;,
## #   satisfaccion &lt;dbl&gt;, buscando_trabajo &lt;chr&gt;
```

---
## filter()

filter() nos permite obtener las filas (observaciones) que cumplen con las condiciones que necesitamos.

Empleados de dos rubros diferentes

```r
encuesta %&gt;%
  filter(rubro == "Servicios de salud"| rubro == "Tecnolog√≠as de Informaci√≥n, Sistemas, y afines")
```

```
## # A tibble: 119 x 15
##    genero  edad universidad rubro empleados origen_capital empleados_rh puesto
##    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt; 
##  1 Femen~    30 Universida~ Serv~       135 Nacional                  3 Admin~
##  2 Femen~    39 Universida~ Tecn~        15 Nacional                  1 Admin~
##  3 Femen~    30 Universida~ Serv~        65 Nacional                  3 Admin~
##  4 Femen~    33 Universida~ Serv~       117 Nacional                  2 Admin~
##  5 Femen~    25 Universida~ Serv~      1900 Nacional                 11 Admin~
##  6 Femen~    35 Universida~ Serv~        30 Nacional                  8 Admin~
##  7 Femen~    28 Universida~ Tecn~        50 Multinacional             5 Admin~
##  8 Femen~    43 Universida~ Serv~       500 Nacional                 10 Admin~
##  9 Femen~    24 Universida~ Tecn~       270 Nacional                  7 Anali~
## 10 Femen~    25 Universida~ Tecn~       200 Nacional                  5 Anali~
## # ... with 109 more rows, and 7 more variables: personas_a_cargo &lt;dbl&gt;,
## #   anios_rh &lt;dbl&gt;, sueldo_bruto &lt;dbl&gt;, aumento &lt;dbl&gt;, erp &lt;chr&gt;,
## #   satisfaccion &lt;dbl&gt;, buscando_trabajo &lt;chr&gt;
```
 
---
## filter()
Una alternativa es usar un vector de selecci√≥n

```r
encuesta %&gt;%
  filter(rubro %in% c("Servicios de salud", "Tecnolog√≠as de Informaci√≥n, Sistemas, y afines")) %&gt;% 
  head()
```

---

## filter()

filter() nos permite obtener las filas (observaciones) que cumplen con las condiciones que necesitamos.

Podemos filtrar un rango de sueldos de la siguiente manera combinando la funci√≥n `between()`:


```r
encuesta %&gt;% 
  filter(between(sueldo_bruto,      # Variable a filtrar 
                 50000,             # Valor m√≠nimo
                 150000)) %&gt;%       # Valor m√°ximo
  head()
```

```
## # A tibble: 6 x 15
##   genero  edad universidad rubro empleados origen_capital empleados_rh puesto
##   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt; 
## 1 Femen~    30 Universida~ Serv~       135 Nacional                  3 Admin~
## 2 Femen~    39 Universida~ Tecn~        15 Nacional                  1 Admin~
## 3 Femen~    23 Universida~ Alim~     10000 Nacional                 40 Admin~
## 4 Femen~    30 Universida~ Serv~        65 Nacional                  3 Admin~
## 5 Femen~    32 Universida~ Serv~     10000 Multinacional            10 Admin~
## 6 Femen~    29 Universida~ Petr~       225 Multinacional             6 Admin~
## # ... with 7 more variables: personas_a_cargo &lt;dbl&gt;, anios_rh &lt;dbl&gt;,
## #   sueldo_bruto &lt;dbl&gt;, aumento &lt;dbl&gt;, erp &lt;chr&gt;, satisfaccion &lt;dbl&gt;,
## #   buscando_trabajo &lt;chr&gt;
```


---
## arrange()

`arrange()` ordena las variables de acuerdo al criterio que queramos. Por default, ordena los datos ascendentemente.

.pull-left[
Ordenar las respuestas por edad


```r
encuesta %&gt;%
  select(puesto, edad) %&gt;%
  arrange(edad) %&gt;% head()
```

```
## # A tibble: 6 x 2
##   puesto    edad
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Analista    21
## 2 Analista    22
## 3 Analista    22
## 4 Analista    22
## 5 Analista    22
## 6 Jefe        22
```

]

--

.pull-right[
La funci√≥n `arrange()` tambi√©n se puede usar con variables de texto.


```r
encuesta %&gt;%
  select(rubro, empleados) %&gt;%
  arrange(rubro) %&gt;% head()
```

```
## # A tibble: 6 x 2
##   rubro                                            empleados
##   &lt;chr&gt;                                                &lt;dbl&gt;
## 1 Agricultura; plantaciones,otros sectores rurales       600
## 2 Agricultura; plantaciones,otros sectores rurales       320
## 3 Agricultura; plantaciones,otros sectores rurales       352
## 4 Agricultura; plantaciones,otros sectores rurales        65
## 5 Agricultura; plantaciones,otros sectores rurales        80
## 6 Agricultura; plantaciones,otros sectores rurales        35
```

]

---
## arrange()

Para ordenar los datos ascendentemente hay dos alternativas.

.pull-left[
Con la funci√≥n `desc()`.


```r
encuesta %&gt;%
  select(puesto, edad) %&gt;%
  arrange(desc(edad)) %&gt;% 
  head()
```

```
## # A tibble: 6 x 2
##   puesto   edad
##   &lt;chr&gt;   &lt;dbl&gt;
## 1 Jefe       63
## 2 Jefe       63
## 3 Jefe       58
## 4 Gerente    54
## 5 Jefe       54
## 6 Gerente    53
```

]

--

.pull-right[
Con el signo menos `-`.

```r
encuesta %&gt;%
  select(puesto, edad) %&gt;%
  arrange(-edad)  %&gt;% 
  head()
```

```
## # A tibble: 6 x 2
##   puesto   edad
##   &lt;chr&gt;   &lt;dbl&gt;
## 1 Jefe       63
## 2 Jefe       63
## 3 Jefe       58
## 4 Gerente    54
## 5 Jefe       54
## 6 Gerente    53
```

]

---

## group_by()

`group_by()` es una funci√≥n para agrupar las variables en funci√≥n de los valores de una de las columnas. Por ejemplo si quiero ver el sueldo por puesto.


```r
encuesta %&gt;%
  select(puesto, sueldo_bruto) %&gt;%
  group_by(puesto) %&gt;% 
  head()
```

```
## # A tibble: 6 x 2
## # Groups:   puesto [1]
##   puesto         sueldo_bruto
##   &lt;chr&gt;                 &lt;dbl&gt;
## 1 Administrativo       41000 
## 2 Administrativo       40000 
## 3 Administrativo       43954.
## 4 Administrativo       40000 
## 5 Administrativo       15000 
## 6 Administrativo       57000
```

---

## summarise()

`summarise()` se usa para crear nuevas columnas con medidas de resumen estad√≠stico. Se suele usar mucho en conjunto con group_by().

Por ejemplo si quiero calcular el sueldo promedio por puesto:


```r
encuesta %&gt;%
  select(puesto, sueldo_bruto) %&gt;%
  group_by(puesto) %&gt;%
* summarise(sueldo_promedio = mean(sueldo_bruto))
```

```
## # A tibble: 7 x 2
##   puesto         sueldo_promedio
##   &lt;chr&gt;                    &lt;dbl&gt;
## 1 Administrativo          44154.
## 2 Analista                68061.
## 3 Director               210788.
## 4 Gerente                230972.
## 5 HRBP                    93805.
## 6 Jefe                   110486.
## 7 Responsable             75024.
```

---

## mutate()

`mutate()` se usa para crear una nueva columna a partir de las columnas que ya existen en el dataset, y/o modificar las variables existentes.

Hagamos el siguiente c√°lculo: pasemos los sueldos que est√°n en pesos argentinos, a d√≥lares. Para lograr eso, tenemos que dividir la variable `sueldo_bruto` por `86.75` que es el precio de venta del d√≥lar.


```r
encuesta %&gt;%
  select(puesto, sueldo_bruto) %&gt;%
* mutate(sueldo_dolar = sueldo_bruto / 86.75) %&gt;%
  head()
```

```
## # A tibble: 6 x 3
##   puesto         sueldo_bruto sueldo_dolar
##   &lt;chr&gt;                 &lt;dbl&gt;        &lt;dbl&gt;
## 1 Administrativo       41000          473.
## 2 Administrativo       40000          461.
## 3 Administrativo       43954.         507.
## 4 Administrativo       40000          461.
## 5 Administrativo       15000          173.
## 6 Administrativo       57000          657.
```
---
## mutate 

Con mutate podemos cambiar las caracter√≠sticas de algunas variables. Por ejemplo, la variable `puesto` es de tipo `character` o nominal, es decir que no nos permite ordenar sus resultados. 

```r
class(encuesta$puesto)
```

```
## [1] "character"
```

Si convertimos esta variable en tipo `factor` podremos definir el orden que nos sirva para representar la jerarqu√≠a.


```r
encuesta %&gt;% select(puesto, sueldo_bruto) %&gt;% 
* mutate(puesto = factor(puesto, levels = c("Director", "Gerente", "Jefe", "Responsable",
*                                           "HRBP", "Analista", "Administrativo"))) %&gt;%
  group_by(puesto) %&gt;% summarise(sueldo_promedio = mean(sueldo_bruto))
```

```
## # A tibble: 7 x 2
##   puesto         sueldo_promedio
##   &lt;fct&gt;                    &lt;dbl&gt;
## 1 Director               210788.
## 2 Gerente                230972.
## 3 Jefe                   110486.
## 4 Responsable             75024.
## 5 HRBP                    93805.
## 6 Analista                68061.
## 7 Administrativo          44154.
```

---
## mutate + case_when

.left-column[
La funci√≥n `case_when` la podemos usar dentro de mutate para crear categor√≠as a partir de variables num√©ricas. 

Usemos esto para crear rangos de empleados, y calcular el sueldo promedio despu√©s.
]

.right-column[


```r
encuesta %&gt;% 
  select(empleados, sueldo_bruto) %&gt;% 
* mutate(cantidad_empleados = case_when(
*   empleados &lt;= 100 ~ "Hasta 100",
*   empleados &lt;= 500 ~ "Hasta 500",
*   empleados &lt;= 1000 ~ "Hasta 1000",
*   empleados &lt;= 5000 ~ "Hasta 5000",
*   empleados = TRUE ~ "M√°s de 5000"
  )) %&gt;% 
  group_by(cantidad_empleados) %&gt;% 
  summarise(sueldo_promedio = mean(sueldo_bruto))
```

```
## # A tibble: 5 x 2
##   cantidad_empleados sueldo_promedio
##   &lt;chr&gt;                        &lt;dbl&gt;
## 1 Hasta 100                   84486.
## 2 Hasta 1000                  88247.
## 3 Hasta 500                  103045.
## 4 Hasta 5000                  94464.
## 5 M√°s de 5000                 92847.
```
]


---

## rename()

Muchas veces los nombres de las tablas vienen con nombres poco comprensibles si no est√°s familiarizado, `rename()` te permite cambiar el nombre de una variable.

Su sintaxis es:

--

1. Nombre nuevo de la variable

--

2. Nombre original de la variable


```r
encuesta &lt;- encuesta %&gt;%
  rename(sistema_gestion = erp) 

names(encuesta)
```

```
##  [1] "genero"           "edad"             "universidad"      "rubro"           
##  [5] "empleados"        "origen_capital"   "empleados_rh"     "puesto"          
##  [9] "personas_a_cargo" "anios_rh"         "sueldo_bruto"     "aumento"         
## [13] "sistema_gestion"  "satisfaccion"     "buscando_trabajo"
```

---
# Transformando datasets

Muchas veces sucede que en los nombres de las columnas, hay datos que son en realidad variables. como por ejemplo en el dataset `kpis`.


```r
kpis
```

```
## # A tibble: 4 x 14
##   Sector KPI     ene   feb   mar   abr   may   jun   jul   ago   sep   oct   nov
##   &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Plant~ Ause~ 0.061 0.045 0.042 0.068 0.083 0.084 0.07  0.059 0.07  0.019 0.063
## 2 Plant~ Hora~ 0.08  0.066 0.03  0.051 0.051 0.04  0.06  0.055 0.041 0.119 0.133
## 3 Plant~ Ause~ 0.04  0.061 0.045 0.072 0.067 0.035 0.052 0.051 0.05  0.065 0.136
## 4 Plant~ Hora~ 0.047 0.02  0.018 0.023 0.022 0.027 0.019 0.034 0.034 0.084 0.091
## # ... with 1 more variable: dic &lt;dbl&gt;
```

--

Esto es lo que se conoce como un dataset *ancho*. Para hacer gr√°ficos sobre su evoluci√≥n, o hacer otros an√°lisis estad√≠sticos, tenemos que pivotearlo para hacerlo un dataset **largo**.

---
# Transformando datasets
## pivot_longer()

Como los meses son una variable m√°s, deber√≠an estar en filas. Para eso usaremos la funci√≥n `pivot_longer` del paquete **tidyr**. 


```r
library(tidyr)

kpis_long &lt;- kpis %&gt;% 
  pivot_longer(cols = c("ene":"dic"), # Selecciona columnas a pivotar
               names_to = "mes",   # Nombre de la variable que contendr√° lo que antes era nombre de columna
               values_to = "tasa") # Nombre de la variable que contendr√° los valores

head(kpis_long)
```

```
## # A tibble: 6 x 4
##   Sector   KPI            mes    tasa
##   &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt; &lt;dbl&gt;
## 1 Planta A Ausentismo (%) ene   0.061
## 2 Planta A Ausentismo (%) feb   0.045
## 3 Planta A Ausentismo (%) mar   0.042
## 4 Planta A Ausentismo (%) abr   0.068
## 5 Planta A Ausentismo (%) may   0.083
## 6 Planta A Ausentismo (%) jun   0.084
```


---
class: inverse, middle

# Secuencia de an√°lisis

## 1. Agrupar los grupos que quiero comparar (group_by)
## 2. Calcular medidas de resumen estad√≠stico (summarise, mutate)
## 3. Graficar los resultados (ggplot)

---
# An√°lisis de kpi's

Primero tenemos que ordenar los meses para que aparezcan en el orden correcto, y no alfab√©ticamente.


```r
kpis_long &lt;- kpis_long %&gt;% 
  mutate(mes = factor(mes, levels = c("ene", "feb", "mar", "abr", "may", "jun",
                                      "jul", "ago", "sep", "oct", "nov", "dic")))
```

---
# An√°lisis de kpi's

Ahora podemos comparar los resultados por planta.

.pull-left[

```r
library(ggplot2)

kpis_long %&gt;% 
  group_by(Sector, KPI) %&gt;% 
  summarise(tasa_anual = mean(tasa)) %&gt;% 
  ggplot(aes(x = KPI, y = tasa_anual)) +
  geom_col() +
  facet_grid(~Sector)
```

]

.pull-right[
&lt;img src="index_files/figure-html/unnamed-chunk-30-1.png" width="504" /&gt;

]

---
# An√°lisis de kpi's

Y ahora podemos hacer un an√°lisis de la evoluci√≥n mensual de estos KPI's

.pull-left[

```r
ggplot(kpis_long, aes(x = mes, y = tasa, group = Sector, colour = Sector)) +
  geom_line(size = 1) +
  geom_point(size = 2)+
  facet_wrap(~KPI,nrow = 2)
```

]

.pull-right[
&lt;img src="index_files/figure-html/unnamed-chunk-31-1.png" width="504" /&gt;

]

---
class: middle
# Muchas gracias!

.pull-left[
&lt;img src="https://media.giphy.com/media/lLp9dTw6qxcD6/giphy.gif" /&gt;
]

.pull-right[
Si te gust√≥ esta sesi√≥n pod√©s suscribirte escribi√©ndonos a [info@r4hr.club](mailto:info@r4hr.club) y acceder a todas las sesiones pasadas, y participar de las pr√≥ximas sesiones con especialistas.

Recuerden compartir sus capturas de pantalla y sensaciones con los hashtags:

* ### #R4HR
* ### #data4hr
* ### #PeopleAnalytics
* ### #RStats_ES
* ### #BetterWithData
]
---
class: inverse, center, middle

## Seguinos en nuestras redes

### [link.tree/r4hrclub](https://www.linktr.ee/r4hrclub) üì°
&lt;img src="https://media.giphy.com/media/93fsZ7rI488L908x0T/giphy.gif" /&gt;



---
class: inverse, center, bottom

# &lt;svg style="height:0.8em;top:.04em;position:relative;fill:white;" viewBox="0 0 480 512"&gt;&lt;path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/&gt;&lt;/svg&gt;
[Repo](https://github.com/r4hr/r4hr_introduccion_dplyr)


Presentaci√≥n realizada con el paquete [Xaringan](https://github.com/yihui/xaringan) desarrollado por Yihui Xie.

Gracias a [Patricia Loto](https://twitter.com/patriloto) por compartir el [tutorial](https://twitter.com/patriloto/status/1260822644590608391?s=20)

&lt;a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"&gt;&lt;img alt="Licencia Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /&gt;&lt;/a&gt;&lt;br /&gt;&lt;span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"&gt;Introducci√≥n a dplyr&lt;/span&gt; por &lt;a xmlns:cc="http://creativecommons.org/ns#" href="https://clubder-dplyr.netlify.app/#1" property="cc:attributionName" rel="cc:attributionURL"&gt;Club de R para RRHH&lt;/a&gt; se distribuye bajo una &lt;a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"&gt;Licencia Creative Commons Atribuci√≥n-NoComercial 4.0 Internacional&lt;/a&gt;.&lt;br /&gt;Basada en una obra en &lt;a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/r4hr/r4hr_introduccion_dplyr" rel="dct:source"&gt;https://github.com/r4hr/r4hr_introduccion_dplyr&lt;/a&gt;.&lt;br /&gt;Permisos m√°s all√° del alcance de esta licencia pueden estar disponibles en &lt;a xmlns:cc="http://creativecommons.org/ns#" href="https://r4hr.club" rel="cc:morePermissions"&gt;https://r4hr.club&lt;/a&gt;.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
